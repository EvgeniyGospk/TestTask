# ZenPulse: AI Meditation App (Prototype)

Прототип мобильного приложения про медитации с paywall-экраном, логикой “Premium/Locked” и vibe-фичей **AI “Настрой дня”** (генерация короткого текста по настроению). Проект сделан под тестовое задание и специально оформлен так, чтобы его было легко расширять без переписывания UI.

---

## Демо (обязательные материалы для сдачи)

- Screencast (7–12 минут): `TODO: link`
- Демо-видео/запись прохождения флоу: `TODO: link`
- Скриншоты: `TODO: link`

---

## Функционал (соответствие ТЗ)

### 1) Экран Paywall (подписка)

- “Дорогой” визуальный стиль (градиенты, аккуратные отступы, типографика).
- Список преимуществ Premium-версии.
- Два тарифа: **Monthly** и **Yearly** (годовой визуально подсвечен как выгодный).
- Кнопка **Try free**:
  - имитирует успешную покупку,
  - сохраняет `isSubscribed = true`,
  - открывает доступ к премиум-контенту.

### 2) Экран Meditations (главный)

- Список медитаций: карточки с изображением и длительностью.
- Часть карточек помечена как `premiumOnly`.
- Если подписка не активна:
  - premium карточки “серые”, с замком,
  - нажатие ведёт обратно на Paywall.

### 3) Vibe-фича: AI “Настрой дня”

- Отдельный экран **AI “Настрой дня”**.
- Пользователь выбирает настроение (3 варианта).
- Нажимает “Сгенерировать”.
- Приложение генерирует короткую аффирмацию/мини-медитацию:
  - через LLM (опционально) **или**
  - через реалистичный мок-ответ (по умолчанию, чтобы прототип работал оффлайн и без ключей).

---

## Технологии

Рекомендуемый (и описанный в документации) стек под скорость/качество:

- **React Native + Expo (Managed) + TypeScript**
- **React Navigation** (stack-навигация)
- **NativeWind** (быстро собирать красивый UI, проще адаптив)
- **expo-linear-gradient** (премиальный фон на Paywall)
- **react-native-safe-area-context** (SafeArea)
- **AsyncStorage** (хранение `isSubscribed` для прототипа)
- Тесты: **Jest** + **React Native Testing Library**

Почему так:
- Expo ускоряет запуск и снижает риск “сломать сборку” в 90 минут.
- NativeWind удобно контролировать адаптив и консистентные отступы.
- Чёткое разделение `screens / features / services` упрощает замену моков на реальные интеграции.

---

## Быстрый старт (Ubuntu)

### Требования

- Node.js LTS (рекомендуется 18+), npm/pnpm
- Android Studio + Android SDK + Emulator (или физический телефон с Expo Go)

Проверка, что эмулятор виден:
- `adb devices`

### Запуск

После установки зависимостей проекта:

- `npm install`
- `npx expo start`
- В Expo Dev Server:
  - `a` — открыть Android Emulator
  - или отсканировать QR код в Expo Go на телефоне

---

## Архитектура (кратко)

Главная цель архитектуры: **UI не знает деталей подписки и AI**, а использует узкие интерфейсы сервисов. Это позволяет:
- заменить мок-покупку на реальные IAP, не переписывая экраны;
- поменять AI провайдера (или полностью отключить) без изменений UI;
- добавлять новые фичи “по папкам”, а не “по всему проекту”.

Подробно: `docs/ARCHITECTURE.md`.

---

## Структура проекта (пример, ожидаемая)

Проект организован по принципу “слои + фичи”:

```text
src/
  app/
    App.tsx
    navigation/
      RootNavigator.tsx
      routes.ts
    providers/
      SubscriptionProvider.tsx
  screens/
    PaywallScreen/
      PaywallScreen.tsx
    MeditationsScreen/
      MeditationsScreen.tsx
    MoodAIScreen/
      MoodAIScreen.tsx
  features/
    meditations/
      data/
        meditations.ts
      domain/
        access.ts
      components/
        MeditationCard.tsx
  services/
    subscription/
      subscription.service.ts
      subscription.types.ts
    ai/
      ai.service.ts
      prompts.ts
      ai.types.ts
    storage/
      storage.ts
  components/
    ui/
      Screen.tsx
      Button.tsx
  theme/
    colors.ts
    spacing.ts
    typography.ts
```

Принципы:
- `screens/*` — сборка экранов (layout, композиция, навигация).
- `features/*` — бизнес-логика конкретной фичи (медитации, доступ, карточки).
- `services/*` — интеграции/моки (подписка, AI, storage).
- `components/ui/*` — переиспользуемые атомарные компоненты.
- `theme/*` — токены дизайна (чтобы UI был “дорогим” и ровным).

---

## Логика подписки (мок)

**Источник истины:** `SubscriptionProvider` хранит `isSubscribed` и предоставляет:
- `isSubscribed` (boolean)
- `buyPremium()` (мок успешной покупки)
- `restore()` (опционально, для расширения)

**Хранение:** `AsyncStorage` (ключ, например `subscription:isSubscribed`).

**Правило доступа к медитации:**
- если `session.premiumOnly === true` и `isSubscribed === false` → карточка locked и ведёт на Paywall.

Это правило инкапсулируется в `features/meditations/domain/access.ts`, чтобы UI не дублировал условия.

---

## AI “Настрой дня”: промпты и моки

Детали: `docs/AI_PROMPTS.md`.

Рекомендуемый подход для прототипа:
- генерация идёт через `services/ai/ai.service.ts`;
- по умолчанию используется “реалистичный мок” с задержкой (600–1200 мс), чтобы:
  - UX ощущался как настоящий запрос,
  - приложение работало без сети и без ключей.

Опционально: подключить реальный LLM (переключатель провайдера через ENV), но это не обязательно для сдачи.

---

## Этапы разработки и история коммитов

Цель: история коммитов должна показывать пошаговую разработку (как просит ТЗ) и совпадать со screencast-логикой.

Подробный план: `docs/DEVELOPMENT_STAGES.md`.

Короткий список этапов:
1. Инициализация Expo + TypeScript + навигация.
2. Базовый layout + SafeArea + дизайн-токены.
3. Paywall UI + выбор тарифов + мок покупки.
4. Meditations список + locked-поведение + редирект на paywall.
5. AI “Настрой дня” (mood → генерация текста).
6. Полировка адаптива (маленькие экраны), QA.
7. Тесты + документация + материалы (видео/скрины).

---

## Тестирование и качество

### Автотесты (минимум, но “в точку”)

- Unit:
  - `features/meditations/domain/access.ts` — правила `locked/unlocked`
  - `services/ai/prompts.ts` — корректная сборка промпта
- Integration (React Native Testing Library):
  - флоу Paywall → Try free → Meditations (контент доступен)
  - нажатие locked карточки при `isSubscribed=false` → переход на Paywall

### Ручная проверка (обязательна под мобилку)

Чеклист: `docs/QA_CHECKLIST.md` (SafeArea, маленькие экраны, клики, скроллы, состояния loading).

---

## Ответ на контрольный вопрос

**С какими специфическими проблемами мобильной верстки ИИ справляется хуже всего и как я контролировал его работу (маленькие экраны iPhone SE vs большие)?**

1) Где ИИ ошибается чаще всего:
- забывает про **SafeArea** и статусбар (текст/кнопки залезают на “чёлку”);
- делает “красиво” на одном размере, но ломает **маленькие экраны** (переполнение по высоте, CTA уезжает вниз);
- не учитывает **динамический текст** (длинные заголовки/локализация, системный размер шрифта);
- недооценивает различия iOS/Android (тени, скролл, размеры кликабельных зон).

2) Как контролировал и не давал UI сломаться:
- ввёл единый `Screen` wrapper с SafeArea и базовыми паддингами;
- сделал Paywall вертикально скроллируемым (ScrollView) и проверил, что CTA доступен на маленьких экранах;
- использовал flex-лейаут и ограничение ширины контейнера (maxWidth) для больших экранов, чтобы UI не “разъезжался”;
- проверял вручную на минимум двух профилях: “маленький экран” и “большой экран”, итеративно правя отступы/размеры после каждой AI-генерации.

---

## Документы

- `docs/ARCHITECTURE.md` — слои, ответственность модулей, расширение
- `docs/AI_PROMPTS.md` — промпты, моки, примеры
- `docs/QA_CHECKLIST.md` — ручной QA под мобилку
- `docs/DEVELOPMENT_STAGES.md` — этапы, критерии готовности, план коммитов и screencast
- `docs/TEST_STRATEGY.md` — набор тестов и что/зачем покрывать
- `docs/REPORT.md` — шаблон отчёта под сдачу (с чеклистом ТЗ)
