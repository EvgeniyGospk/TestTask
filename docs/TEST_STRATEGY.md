# Стратегия тестирования

Цель тестов в этом прототипе — подтвердить ключевую бизнес-логику и критические пользовательские флоу, не превращая тестовое задание в “проект на неделю”.

## Пирамида тестов (что действительно окупается)

1) **Unit-тесты (быстро, точно)**
- правила доступа к контенту (locked/unlocked)
- сборка AI промпта (ограничения на длину/тон)

2) **Integration/UI-тесты (немного, но про флоу)**
- переходы между экранами
- gating: тап по locked → paywall
- успешная “покупка” → доступ к премиум-карточкам

3) **E2E (опционально)**
- для прототипа не обязательно; можно указать как “next step”

---

## Инструменты (рекомендованные)

- **Jest** — unit и integration
- **React Native Testing Library** — UI/навигация
- Моки:
  - AsyncStorage mock (официальный/рекомендованный для Jest)
  - Мок навигации через `NavigationContainer`

---

## Что тестировать (конкретные кейсы)

### Unit: `features/meditations/domain/access.ts`

Кейсы:
- premiumOnly=true и isSubscribed=false → locked=true
- premiumOnly=true и isSubscribed=true → locked=false
- premiumOnly=false и isSubscribed=false → locked=false

Ожидания:
- функция чистая, без зависимостей от React/Storage
- покрытие кейсов не зависит от UI

### Unit: `services/ai/prompts.ts`

Кейсы:
- для каждого mood промпт содержит человекочитаемое настроение
- промпт содержит ограничения “1–3 предложения”
- промпт содержит запреты на медицинские обещания

Ожидания:
- промпт строится детерминированно (с одинаковым входом — одинаковый выход)

### Integration: навигация + gating

Кейсы:
- старт → Meditations → тап по locked карточке → Paywall → Try free → назад на Meditations
- при `isSubscribed=false`: premium карточки locked и ведут на Paywall
- при `isSubscribed=true`: locked карточек нет (или они активны)

Ожидания:
- тест не зависит от реального API/сети (моки сервисов)
- проверяется именно поведение пользователя (клики/переходы), а не внутренние детали

---

## Минимальная “Definition of Done” по качеству

- Все unit-тесты проходят и покрывают ключевые правила.
- Есть хотя бы 1–2 integration теста на критический флоу.
- Пройден ручной чеклист на маленьком и большом экране: `docs/QA_CHECKLIST.md`.

---

## Что можно добавить позже (не обязательно для сдачи)

- GitHub Actions: запуск `lint` + `test` на PR.
- E2E через Detox (дольше в настройке, чем окупается в 90 минут).
- Snapshot-тесты UI (часто дают шум, поэтому для прототипа спорно).
